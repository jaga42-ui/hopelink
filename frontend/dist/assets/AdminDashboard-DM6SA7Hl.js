import{r as i,A,u as k,z as l,j as e,v as F,a1 as T,M as U,J as _,f as E,a2 as R,a3 as S,a4 as D,P as $}from"./index-BWa_XzmO.js";import{L as C}from"./Layout-DVG1ybMn.js";import{a as d}from"./api-Dehz_W2t.js";import"./logo-DmaGRGNz.js";const B=()=>{const{user:a}=i.useContext(A),p=k(),[o,f]=i.useState("overview"),[c,j]=i.useState(null),[x,h]=i.useState([]),[g,b]=i.useState([]),[w,u]=i.useState(!0);i.useEffect(()=>{a&&!a.isAdmin&&(l.error("Unauthorized Area"),p("/dashboard"))},[a,p]),i.useEffect(()=>{if(!a?.isAdmin)return;(async()=>{try{const[s,r,n]=await Promise.all([d.get("/admin/stats"),d.get("/admin/users"),d.get("/admin/listings")]);j(s.data),h(r.data),b(n.data),u(!1)}catch{l.error("Failed to load admin data"),u(!1)}})()},[a]);const N=async(t,s)=>{if(window.confirm(`Are you sure you want to PERMANENTLY BAN ${s} and delete all their posts?`))try{await d.delete(`/admin/users/${t}`),h(x.filter(r=>r._id!==t)),l.success("User banished.")}catch{l.error("Failed to delete user")}},v=async(t,s,r)=>{if(window.confirm(`Are you sure you want to ${r?"REVOKE Admin rights from":"PROMOTE"} ${s}?`))try{const{data:n}=await d.patch(`/admin/users/${t}/role`);h(x.map(m=>m._id===t?{...m,isAdmin:n.isAdmin}:m)),l.success(n.message)}catch(n){l.error(n.response?.data?.message||"Failed to update user role")}},y=async t=>{if(window.confirm("Force delete this listing from the database?"))try{await d.delete(`/admin/listings/${t}`),b(g.filter(s=>s._id!==t)),l.success("Listing obliterated.")}catch{l.error("Failed to delete listing")}};return!a||!a.isAdmin?null:e.jsx(C,{children:e.jsxs("div",{className:"max-w-6xl mx-auto pb-20",children:[e.jsxs("header",{className:"mb-8 border-b border-white/10 pb-6 flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-red-500",children:[e.jsx(F,{className:"text-5xl drop-shadow-[0_0_15px_rgba(239,68,68,0.5)]"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-black text-white tracking-tighter",children:["COMMAND ",e.jsx("span",{className:"text-red-500",children:"CENTER"})]}),e.jsx("p",{className:"text-red-400/50 text-[10px] uppercase font-black tracking-[0.3em]",children:"System Administrator Access"})]})]}),e.jsx("div",{className:"flex bg-[#111] p-1.5 rounded-2xl border border-white/10",children:[{id:"overview",label:"Overview",icon:e.jsx(T,{})},{id:"users",label:"Manage Users",icon:e.jsx(U,{})},{id:"listings",label:"Content Moderation",icon:e.jsx(_,{})}].map(t=>e.jsxs("button",{onClick:()=>f(t.id),className:`px-6 py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all flex items-center gap-2 ${o===t.id?"bg-red-500 text-white shadow-lg shadow-red-500/20":"text-white/40 hover:text-white"}`,children:[t.icon," ",e.jsx("span",{className:"hidden sm:inline",children:t.label})]},t.id))})]}),w?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(E,{className:"animate-spin text-4xl text-red-500"})}):e.jsxs("div",{className:"space-y-6",children:[o==="overview"&&c&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[{title:"Total Users",value:c.totalUsers,color:"text-blue-400"},{title:"Active Donations",value:c.totalDonations,color:"text-teal-400"},{title:"Active Requests",value:c.totalRequests,color:"text-yellow-400"},{title:"Items Fulfilled",value:c.fulfilledItems,color:"text-green-400"}].map((t,s)=>e.jsxs("div",{className:"bg-[#111] border border-white/10 rounded-[2rem] p-8 relative overflow-hidden group",children:[e.jsx("h3",{className:`text-6xl font-black ${t.color} mb-2`,children:t.value}),e.jsx("p",{className:"text-white/40 text-[10px] uppercase font-black tracking-widest",children:t.title})]},s))}),o==="users"&&e.jsx("div",{className:"bg-[#111] border border-white/10 rounded-[2rem] overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm whitespace-nowrap",children:[e.jsx("thead",{className:"bg-black/40 text-white/40 text-[10px] uppercase tracking-widest",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 font-black",children:"User"}),e.jsx("th",{className:"px-6 py-4 font-black",children:"Email"}),e.jsx("th",{className:"px-6 py-4 font-black",children:"Points"}),e.jsx("th",{className:"px-6 py-4 font-black",children:"Joined"}),e.jsx("th",{className:"px-6 py-4 font-black text-right",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:x.map(t=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center font-black text-white",children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white",children:t.name}),t.isAdmin&&e.jsx("span",{className:"text-[8px] bg-red-500/20 text-red-400 px-2 py-0.5 rounded font-black uppercase",children:"Admin"})]})]}),e.jsx("td",{className:"px-6 py-4 text-white/60",children:t.email}),e.jsxs("td",{className:"px-6 py-4 font-black text-yellow-400",children:[t.points," XP"]}),e.jsx("td",{className:"px-6 py-4 text-white/40",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-right flex justify-end gap-2",children:t._id!==a._id&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>v(t._id,t.name,t.isAdmin),className:`p-2 rounded-lg transition-all ${t.isAdmin?"bg-orange-500/10 text-orange-400 hover:bg-orange-500 hover:text-white":"bg-blue-500/10 text-blue-400 hover:bg-blue-500 hover:text-white"}`,title:t.isAdmin?"Revoke Admin":"Make Admin",children:t.isAdmin?e.jsx(R,{}):e.jsx(S,{})}),e.jsx("button",{onClick:()=>N(t._id,t.name),className:"bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white p-2 rounded-lg transition-all",title:"Ban User completely",children:e.jsx(D,{})})]})})]},t._id))})]})})}),o==="listings"&&e.jsx("div",{className:"bg-[#111] border border-white/10 rounded-[2rem] overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm whitespace-nowrap",children:[e.jsx("thead",{className:"bg-black/40 text-white/40 text-[10px] uppercase tracking-widest",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 font-black",children:"Type"}),e.jsx("th",{className:"px-6 py-4 font-black",children:"Title"}),e.jsx("th",{className:"px-6 py-4 font-black",children:"Owner"}),e.jsx("th",{className:"px-6 py-4 font-black",children:"Status"}),e.jsx("th",{className:"px-6 py-4 font-black text-right",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:g.map(t=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-[9px] font-black uppercase px-2 py-1 rounded ${t.listingType==="request"?"bg-blue-500/20 text-blue-400":"bg-teal-500/20 text-teal-400"}`,children:t.listingType})}),e.jsx("td",{className:"px-6 py-4 font-bold text-white max-w-[200px] truncate",children:t.title}),e.jsx("td",{className:"px-6 py-4 text-white/60",children:t.donorId?.name||"Deleted User"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-[9px] font-black uppercase px-2 py-1 rounded ${t.status==="fulfilled"?"text-green-400":"text-yellow-400"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>y(t._id),className:"bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white p-2 rounded-lg transition-all",title:"Force Delete",children:e.jsx($,{})})})]},t._id))})]})})})]})]})})};export{B as default};
