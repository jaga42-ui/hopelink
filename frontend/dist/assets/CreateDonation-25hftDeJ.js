import{r,A as E,u as V,j as e,F as M,a as f,b as H,c as W,d as O,e as A,f as $,g as Q,h as _,i as Y,k as J,z as n,l as F}from"./index-BWa_XzmO.js";import{L as K}from"./Layout-DVG1ybMn.js";import{a as X}from"./api-Dehz_W2t.js";import{A as Z}from"./index-BKbUjVKr.js";import{m as w}from"./proxy-Cu6WgvPD.js";import"./logo-DmaGRGNz.js";const le=()=>{const{user:u}=r.useContext(E),S=V(),[t,i]=r.useState({listingType:u?.activeRole==="receiver"?"request":"donation",category:"food",title:"",description:"",quantity:"",addressText:u?.addressText||"",condition:"Gently Used",foodType:"Veg",expiryDate:"",pickupTime:"",bookAuthor:""}),[h,D]=r.useState(null),[y,L]=r.useState(null),[v,m]=r.useState(!1),[j,b]=r.useState([]),[k,g]=r.useState(!1),[N,q]=r.useState(null),s=t.listingType==="request",d=s?"text-blue-400":"text-teal-400",T=s?"bg-blue-500":"bg-teal-500",P=s?"hover:bg-blue-400":"hover:bg-teal-400",l=s?"border-blue-500":"border-teal-500",I=()=>{if(!navigator.geolocation){n.error("Geolocation is not supported by your browser");return}g(!0),navigator.geolocation.getCurrentPosition(async a=>{try{const{latitude:o,longitude:c}=a.coords,{data:p}=await F.get(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${o}&lon=${c}&email=hopelink.dev@example.com`),x=p.address,C=x.city||x.town||x.village||x.state||"Unknown Location";i(z=>({...z,addressText:C})),n.success(`Location locked: ${C}`)}catch{n.error("Could not resolve location address")}finally{g(!1)}},()=>{g(!1),n.error("Please allow location permissions")})},U=a=>{const o=a.target.value;if(i(c=>({...c,addressText:o})),N&&clearTimeout(N),o.length>2){const c=setTimeout(async()=>{try{const{data:p}=await F.get(`https://nominatim.openstreetmap.org/search?format=json&q=${o}&limit=4&email=hopelink.dev@example.com`);b(p)}catch{console.error("Autocomplete failed")}},600);q(c)}else b([])},B=a=>{const o=a.split(",")[0];i(c=>({...c,addressText:o})),b([])},R=a=>{const o=a.target.files[0];o&&(D(o),L(URL.createObjectURL(o)))},G=async a=>{if(a.preventDefault(),!s&&!h)return n.error("Please upload an image of the item you are donating.");m(!0);try{const o=new FormData;if(o.append("listingType",t.listingType),o.append("category",t.category),o.append("title",t.title),o.append("description",t.description),o.append("quantity",t.quantity),o.append("addressText",t.addressText),o.append("pickupTime",t.pickupTime),h&&o.append("image",h),t.category==="food"){if(!s&&!t.expiryDate)return m(!1),n.error("Please provide an expiry/consume-by date for food safety.");o.append("expiryDate",t.expiryDate),o.append("foodType",t.foodType)}else t.category==="clothes"?o.append("condition",t.condition):t.category==="book"&&(o.append("bookAuthor",t.bookAuthor),o.append("condition",t.condition));await X.post("/donations",o),n.success(s?"Request posted successfully!":"Donation listed successfully!"),S("/dashboard")}catch(o){n.error(o.response?.data?.message||"Failed to post listing")}finally{m(!1)}};return u?e.jsx(K,{children:e.jsxs("div",{className:"max-w-4xl mx-auto pb-24",children:[e.jsxs("header",{className:"mb-8 text-center md:text-left flex flex-col md:flex-row md:items-end justify-between gap-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-black text-white italic tracking-tighter transition-colors duration-500",children:[s?"REQUEST AN ":"LIST AN ",e.jsx("span",{className:d,children:"ITEM."})]}),e.jsx("p",{className:"text-white/40 font-bold uppercase tracking-[0.3em] text-[10px] mt-2",children:s?"Ask the community for help":"Provide details to help the community"})]}),e.jsxs("div",{className:"flex bg-[#111] border border-white/10 rounded-full p-1.5 shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-1.5 bottom-1.5 w-[calc(50%-6px)] rounded-full transition-all duration-300 ease-out ${T}`,style:{left:s?"calc(50% + 3px)":"3px"}}),e.jsx("button",{type:"button",onClick:()=>i({...t,listingType:"donation"}),className:`relative z-10 flex-1 px-6 py-3 font-black text-xs uppercase tracking-widest transition-colors ${s?"text-white/40 hover:text-white/80":"text-white"}`,children:"I Want To Donate"}),e.jsx("button",{type:"button",onClick:()=>i({...t,listingType:"request"}),className:`relative z-10 flex-1 px-6 py-3 font-black text-xs uppercase tracking-widest transition-colors ${s?"text-white":"text-white/40 hover:text-white/80"}`,children:"I Need An Item"})]})]}),e.jsxs("form",{onSubmit:G,className:`bg-[#111] border rounded-[2rem] p-6 md:p-10 shadow-2xl space-y-8 transition-colors duration-500 ${s?"border-blue-500/20":"border-teal-500/20"}`,children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-white font-bold flex items-center gap-2 border-b border-white/10 pb-3 transition-colors duration-500",children:[e.jsx(M,{className:d})," Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Category"}),e.jsxs("select",{value:t.category,onChange:a=>i({...t,category:a.target.value}),className:`w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none transition-colors appearance-none cursor-pointer focus:${l}`,children:[e.jsx("option",{value:"food",children:"ðŸ± Food & Groceries"}),e.jsx("option",{value:"clothes",children:"ðŸ‘• Clothes & Apparel"}),e.jsx("option",{value:"book",children:"ðŸ“š Books & Education"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Title"}),e.jsx("input",{required:!0,value:t.title,onChange:a=>i({...t,title:a.target.value}),placeholder:s?"e.g. Need Class 10 Math Textbook":"e.g. Fresh Bread & Apples",className:`w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none transition-colors focus:${l}`})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Description"}),e.jsx("textarea",{required:!0,value:t.description,onChange:a=>i({...t,description:a.target.value}),placeholder:s?"Why do you need it? Any specific details?":"Describe the item details...",rows:"3",className:`w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white text-sm outline-none transition-colors resize-none focus:${l}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Quantity"}),e.jsx("input",{required:!0,value:t.quantity,onChange:a=>i({...t,quantity:a.target.value}),placeholder:"e.g. 5 Servings / 2 Books",className:`w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none transition-colors h-[calc(100%-24px)] focus:${l}`})]})]})]}),e.jsxs("div",{className:`border rounded-3xl p-6 space-y-6 transition-colors duration-500 ${s?"bg-blue-500/5 border-blue-500/20":"bg-teal-500/5 border-teal-500/20"}`,children:[e.jsxs("h3",{className:"text-white font-bold flex items-center gap-2 border-b border-white/10 pb-3",children:[e.jsx(f,{className:d})," Specific Details"]}),e.jsx(Z,{mode:"wait",children:t.category==="food"?e.jsxs(w.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"grid grid-cols-1 md:grid-cols-2 gap-6 overflow-hidden",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 flex items-center gap-2",children:[e.jsx(H,{})," Diet Type"]}),e.jsxs("select",{value:t.foodType,onChange:a=>i({...t,foodType:a.target.value}),className:`w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none transition-colors appearance-none cursor-pointer focus:${l}`,children:[e.jsx("option",{value:"Veg",children:"Vegetarian"}),e.jsx("option",{value:"Non-Veg",children:"Non-Vegetarian"}),e.jsx("option",{value:"Vegan",children:"Vegan"}),e.jsx("option",{value:"Packaged",children:"Packaged/Sealed"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 flex items-center gap-2",children:[e.jsx(W,{})," ",s?"Latest Date Needed":"Best Before / Expiry"]}),e.jsx("input",{type:"date",required:!s&&t.category==="food",value:t.expiryDate,onChange:a=>i({...t,expiryDate:a.target.value}),className:`w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none transition-colors [color-scheme:dark] focus:${l}`})]})]},"food"):t.category==="book"?e.jsxs(w.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"grid grid-cols-1 md:grid-cols-2 gap-6 overflow-hidden",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 flex items-center gap-2",children:[e.jsx(O,{})," Author / Publisher"]}),e.jsx("input",{required:!0,value:t.bookAuthor,onChange:a=>i({...t,bookAuthor:a.target.value}),placeholder:"e.g. R.S. Aggarwal",className:`w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none transition-colors focus:${l}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 flex items-center gap-2",children:[e.jsx(f,{})," Condition ",s?"Accepted":""]}),e.jsxs("select",{value:t.condition,onChange:a=>i({...t,condition:a.target.value}),className:`w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none transition-colors appearance-none cursor-pointer focus:${l}`,children:[e.jsx("option",{value:"New",children:"Brand New"}),e.jsx("option",{value:"Like New",children:"Like New"}),e.jsx("option",{value:"Gently Used",children:"Gently Used / Marked"}),s&&e.jsx("option",{value:"Any",children:"Any Condition is Fine"})]})]})]},"book"):e.jsxs(w.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:[e.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 flex items-center gap-2",children:[e.jsx(f,{})," Item Condition"]}),e.jsxs("select",{value:t.condition,onChange:a=>i({...t,condition:a.target.value}),className:`w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none transition-colors appearance-none cursor-pointer focus:${l}`,children:[e.jsx("option",{value:"New",children:"Brand New / Unused"}),e.jsx("option",{value:"Like New",children:"Like New"}),e.jsx("option",{value:"Gently Used",children:"Gently Used"}),s?e.jsx("option",{value:"Any",children:"Any Condition is Fine"}):e.jsx("option",{value:"Worn/Old",children:"Worn / Needs Repair"})]})]},"clothes")})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-white font-bold flex items-center gap-2 border-b border-white/10 pb-3",children:[e.jsx(A,{className:d})," Logistics & Media"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Your Location"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{required:!0,value:t.addressText,onChange:U,placeholder:"Type city or use GPS...",className:`flex-1 bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none transition-colors focus:${l}`}),e.jsx("button",{type:"button",onClick:I,disabled:k,className:`px-5 rounded-2xl transition-all disabled:opacity-50 flex items-center justify-center border ${s?"bg-blue-500/10 text-blue-400 border-blue-500/30 hover:bg-blue-500 hover:text-white":"bg-teal-500/10 text-teal-400 border-teal-500/30 hover:bg-teal-500 hover:text-white"}`,title:"Use GPS",children:k?e.jsx($,{className:"animate-spin text-lg"}):e.jsx(A,{className:"text-lg"})})]}),j.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-2 bg-[#1a1a1a] border border-white/10 rounded-xl overflow-hidden shadow-2xl",children:j.map((a,o)=>e.jsx("div",{onClick:()=>B(a.display_name),className:"px-5 py-3 text-sm text-white/70 hover:text-white hover:bg-white/5 cursor-pointer border-b border-white/5 last:border-0 truncate",children:a.display_name},o))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 flex items-center gap-2",children:[e.jsx(Q,{})," Preferred ",s?"Meetup":"Pickup"," Time"]}),e.jsx("input",{required:!0,value:t.pickupTime,onChange:a=>i({...t,pickupTime:a.target.value}),placeholder:"e.g. After 6 PM today, Weekends only",className:`w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none transition-colors focus:${l}`})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:["Reference Image ",s&&"(Optional)"]}),e.jsxs("div",{className:`relative w-full h-[calc(100%-24px)] min-h-[150px] bg-black/40 border-2 border-dashed border-white/20 rounded-2xl flex flex-col items-center justify-center transition-colors overflow-hidden group cursor-pointer ${s?"hover:border-blue-500/50":"hover:border-teal-500/50"}`,children:[e.jsx("input",{type:"file",accept:"image/*",onChange:R,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),y?e.jsx("img",{src:y,alt:"Preview",className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"}):e.jsxs("div",{className:"text-center p-4",children:[e.jsx(_,{className:`text-3xl text-white/20 mx-auto mb-3 transition-colors ${s?"group-hover:text-blue-400":"group-hover:text-teal-400"}`}),e.jsx("p",{className:"text-white/60 text-sm font-bold",children:s?"Upload a reference photo":"Upload an image"}),e.jsx("p",{className:"text-white/40 text-[10px] uppercase tracking-widest mt-1",children:s?"Helps people know what you need":"Clear photos get claimed faster"})]})]})]})]})]}),e.jsx("button",{type:"submit",disabled:v,className:`w-full mt-8 py-5 rounded-2xl font-black text-white uppercase tracking-[0.2em] text-sm transition-all shadow-lg disabled:opacity-50 flex items-center justify-center gap-3 ${T} ${P} ${s?"shadow-blue-500/20":"shadow-teal-500/20"}`,children:v?e.jsx($,{className:"animate-spin text-xl"}):s?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"text-lg"})," Broadcast Request"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"text-lg"})," Publish Donation"]})})]})]})}):null};export{le as default};
