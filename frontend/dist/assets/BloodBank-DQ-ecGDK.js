import{r as a,A as F,j as e,m as d,f as B,t as g,K as E,a8 as q,z as r}from"./index-BWa_XzmO.js";import{L as b}from"./Layout-DVG1ybMn.js";import{a as w}from"./api-Dehz_W2t.js";import{m as x}from"./proxy-Cu6WgvPD.js";import{A as R}from"./index-BKbUjVKr.js";import"./logo-DmaGRGNz.js";const _=()=>{const{user:m}=a.useContext(F),[i,h]=a.useState([]),[o,j]=a.useState("All"),[N,u]=a.useState(!0),[p,l]=a.useState(!1),y=["All","A+","A-","B+","B-","O+","O-","AB+","AB-"],n=async(t=null,s=null)=>{try{u(!0);let c="/donations/blood-donors";t&&s&&(c+=`?lat=${t}&lng=${s}`);const{data:A}=await w.get(c);h(A)}catch{r.error("Failed to load the blood bank feed")}finally{u(!1),l(!1)}};a.useEffect(()=>{m&&navigator.geolocation.getCurrentPosition(t=>n(t.coords.latitude,t.coords.longitude),()=>n())},[m]);const v=()=>{l(!0),navigator.geolocation.getCurrentPosition(t=>{n(t.coords.latitude,t.coords.longitude),r.success("Feed updated with nearest requests!")},()=>{l(!1),r.error("Location access denied.")})},k=async t=>{if(window.confirm("Commit to this blood request? Your contact info will be shared."))try{await w.put(`/donations/${t}`,{status:"accepted"}),r.success("Thank you! Please check your Dashboard for contact details."),h(i.filter(s=>s._id!==t))}catch(s){r.error(s.response?.data?.message||"Failed to respond to request")}},f=i.filter(t=>o==="All"?!0:t.bloodGroup===o);return N&&i.length===0?e.jsx(b,{children:e.jsx("div",{className:"p-10 text-red-400 font-black animate-pulse italic",children:"SCANNING FOR BLOOD REQUESTS..."})}):e.jsx(b,{children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 pb-20",children:[e.jsxs("header",{className:"mb-10 pt-8 flex flex-col md:flex-row md:items-end justify-between gap-6",children:[e.jsxs("div",{children:[e.jsxs(x.h1,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"text-6xl font-black text-white tracking-tighter italic flex items-center gap-4",children:[e.jsx(d,{className:"text-red-500"})," BLOOD",e.jsx("span",{className:"text-red-400",children:"BANK."})]}),e.jsx("p",{className:"text-white/40 font-bold uppercase tracking-[0.3em] text-[10px] mt-2",children:"Emergency Transfusion Network"})]}),e.jsx("button",{onClick:v,disabled:p,className:"bg-red-500/20 text-red-400 border border-red-500/30 px-6 py-3 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-red-500 hover:text-white transition flex items-center justify-center gap-2",children:p?e.jsx(B,{className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(g,{})," Find Near Me"]})})]}),e.jsx("div",{className:"flex gap-4 mb-10 overflow-x-auto pb-4 no-scrollbar",children:y.map(t=>e.jsx("button",{onClick:()=>j(t),className:`min-w-[70px] py-3 rounded-2xl font-black transition-all text-sm tracking-wide ${o===t?"bg-red-500 text-white shadow-lg shadow-red-500/30 scale-105":"bg-white/5 text-white/60 hover:bg-white/10 hover:text-white border border-white/10"}`,children:t},t))}),e.jsx(x.div,{layout:!0,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.jsx(R,{children:f.length>0?f.map(t=>e.jsxs(x.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:`bg-white/5 backdrop-blur-3xl border rounded-[3rem] p-8 relative overflow-hidden flex flex-col transition-all group ${t.isEmergency?"border-red-500/50 shadow-[0_0_30px_rgba(239,68,68,0.2)]":"border-white/10 hover:border-white/20"}`,children:[t.isEmergency&&e.jsxs("div",{className:"absolute top-0 right-0 px-6 py-2 bg-red-500 text-white font-black text-[10px] uppercase tracking-widest rounded-bl-[2rem] flex items-center gap-2 animate-pulse",children:[e.jsx(E,{})," Urgent"]}),e.jsxs("div",{className:"flex items-center gap-6 mb-6 mt-2",children:[e.jsx("div",{className:"w-20 h-20 rounded-3xl bg-red-500/10 border border-red-500/30 flex items-center justify-center text-red-500 font-black text-3xl shadow-inner",children:t.bloodGroup}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/40 font-bold uppercase tracking-widest text-[10px] mb-1",children:"Required"}),e.jsxs("h3",{className:"text-white font-bold text-xl leading-tight",children:[t.quantity," Units"]})]})]}),e.jsx("p",{className:"text-white/80 font-medium text-sm mb-6 flex-1 line-clamp-3",children:t.description}),e.jsxs("div",{className:"space-y-3 mb-8",children:[e.jsxs("div",{className:"flex items-start gap-3 text-white/50 text-xs font-medium",children:[e.jsx(g,{className:"mt-1 flex-shrink-0 text-red-400"}),e.jsx("span",{className:"leading-snug",children:t.location?.formattedAddress||"Location hidden until accepted"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-white/50 text-xs font-medium",children:[e.jsx(q,{className:"text-red-400"}),e.jsx("span",{children:t.donor?.name||"Unknown Requestor"})]})]}),e.jsxs("button",{onClick:()=>k(t._id),className:`w-full py-4 rounded-2xl font-black text-sm flex items-center justify-center gap-2 transition-all active:scale-95 shadow-xl ${t.isEmergency?"bg-red-500 text-white hover:bg-red-600":"bg-white text-red-800 hover:bg-red-50"}`,children:[e.jsx(d,{})," RESPOND NOW"]})]},t._id)):e.jsxs("div",{className:"col-span-full py-24 bg-white/5 rounded-[3rem] border border-dashed border-white/10 text-center flex flex-col items-center justify-center",children:[e.jsx(d,{className:"text-white/10 text-6xl mb-4"}),e.jsx("p",{className:"text-white/40 font-bold text-lg uppercase tracking-widest",children:"No matching requests found."})]})})})]})})};export{_ as default};
