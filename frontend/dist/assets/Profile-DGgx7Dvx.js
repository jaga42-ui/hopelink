import{r as l,A as L,j as e,S as T,v as G,R as N,w as D,C as X,m as B,t as E,f as $,e as z,Q as _,T as I,U as R,J as U,V as M,z as c,l as O}from"./index-BWa_XzmO.js";import{L as V}from"./Layout-DVG1ybMn.js";import{a as y}from"./api-Dehz_W2t.js";import{m as u}from"./proxy-Cu6WgvPD.js";import{A as Y}from"./index-BKbUjVKr.js";import"./logo-DmaGRGNz.js";const Z=()=>{const{user:t,login:k}=l.useContext(L),[g,F]=l.useState({totalDonations:0,activeListings:0,bloodDonations:0}),[w,f]=l.useState(!0),[x,h]=l.useState(!1),[j,m]=l.useState(!1),[r,n]=l.useState({name:t?.name||"",bloodGroup:t?.bloodGroup||"",phone:t?.phone||"",addressText:t?.addressText||""}),d=t?.activeRole==="donor",i=d?"text-teal-400":"text-blue-400",C=d?"bg-teal-500":"bg-blue-500",S=d?"shadow-[0_0_60px_rgba(20,184,166,0.15)]":"shadow-[0_0_60px_rgba(59,130,246,0.15)]";l.useEffect(()=>{const s=async()=>{if(t?.token)try{const{data:a}=await y.get("/donations/my-history"),p=a.filter(o=>o.status==="available"||o.status==="pending").length,b=a.filter(o=>o.category==="blood").length;F({totalDonations:a.length,activeListings:p,bloodDonations:b}),f(!1)}catch{f(!1)}};n({name:t?.name||"",bloodGroup:t?.bloodGroup||"",phone:t?.phone||"",addressText:t?.addressText||""}),s()},[t]);const A=()=>{if(!navigator.geolocation){c.error("Geolocation is not supported by your browser");return}m(!0),navigator.geolocation.getCurrentPosition(async s=>{try{const{latitude:a,longitude:p}=s.coords,{data:b}=await O.get(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${a}&lon=${p}&email=hopelink.dev@example.com`),o=b.address,v=o.city||o.town||o.village||o.state||"Unknown Location";n({...r,addressText:v}),c.success(`Location found: ${v}`)}catch{c.error("Could not resolve location address")}finally{m(!1)}},()=>{m(!1),c.error("Please allow location permissions in your browser")})},P=async s=>{s.preventDefault();try{const{data:a}=await y.put("/auth/profile",r);k(a),h(!1),c.success("Identity updated successfully.")}catch(a){c.error(a.response?.data?.message||"Failed to update profile")}};return t?e.jsx(V,{children:e.jsxs("div",{className:"max-w-6xl mx-auto pb-24",children:[e.jsxs("header",{className:"mb-12 border-b border-white/10 pb-8 flex flex-col md:flex-row md:items-end justify-between gap-6",children:[e.jsxs("div",{children:[e.jsxs(u.h1,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"text-5xl md:text-6xl font-black text-white italic tracking-tighter",children:["MY ",e.jsx("span",{className:i,children:"LEGACY."})]}),e.jsx("p",{className:"text-white/40 font-bold uppercase tracking-[0.3em] text-[10px] mt-2",children:"Identity & Community Impact Dashboard"})]}),!x&&e.jsxs("button",{onClick:()=>h(!0),className:"px-6 py-3 rounded-full font-black text-xs uppercase tracking-widest bg-white/5 text-white/70 border border-white/10 hover:bg-white/10 hover:text-white transition-all flex items-center justify-center gap-2 backdrop-blur-md",children:[e.jsx(T,{})," Update Dossier"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("div",{className:"lg:col-span-4 space-y-8",children:e.jsxs("div",{className:`bg-[#0a0a0a] border border-white/10 rounded-[2.5rem] p-8 relative overflow-hidden ${S} transition-all duration-500`,children:[e.jsx("div",{className:`absolute top-0 left-0 w-full h-40 opacity-20 bg-gradient-to-b ${d?"from-teal-500":"from-blue-500"} to-transparent pointer-events-none`}),e.jsxs("div",{className:"flex flex-col items-center text-center relative z-10",children:[e.jsxs("div",{className:"relative mb-6 group",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-full blur-xl group-hover:blur-2xl transition-all duration-500"}),t.profilePic?e.jsx("img",{src:t.profilePic,alt:"Profile",referrerPolicy:"no-referrer",className:"w-36 h-36 rounded-full object-cover shadow-2xl border-4 border-[#111] relative z-10"}):e.jsx("div",{className:`w-36 h-36 rounded-full flex items-center justify-center text-white font-black text-6xl shadow-2xl border-4 border-[#111] relative z-10 bg-gradient-to-tr ${d?"from-teal-400 to-emerald-800":"from-blue-400 to-indigo-800"}`,children:t.name.charAt(0)}),e.jsx("div",{className:"absolute -bottom-2 -right-2 bg-yellow-400 text-black p-2.5 rounded-full shadow-lg border-4 border-[#0a0a0a] z-20",title:t.rank||"Member",children:e.jsx(G,{className:"text-sm"})})]}),!x&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-3xl font-black text-white tracking-tight",children:t.name}),e.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest mt-2 ${i}`,children:t.rank||(t.isAdmin?e.jsx("span",{className:"text-red-400",children:"System Admin"}):"Verified Member")}),e.jsx("div",{className:"mt-6 flex items-center justify-center gap-4 bg-black/40 px-6 py-3 rounded-2xl border border-white/5 w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"text-yellow-400 text-xl drop-shadow-[0_0_8px_rgba(250,204,21,0.5)]"}),t.totalRatings>0?e.jsxs("div",{className:"flex flex-col items-start leading-none",children:[e.jsx("span",{className:"text-white font-black text-xl",children:t.rating?.toFixed(1)}),e.jsxs("span",{className:"text-white/40 text-[9px] uppercase font-bold tracking-widest mt-0.5",children:[t.totalRatings," Endorsements"]})]}):e.jsx("span",{className:"text-white font-black text-xs tracking-widest uppercase ml-1",children:"Unranked"})]})})]})]}),e.jsx(Y,{mode:"wait",children:x?e.jsxs(u.form,{onSubmit:P,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"mt-6 space-y-4 relative z-10",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Full Name"}),e.jsx("input",{value:r.name,onChange:s=>n({...r,name:s.target.value}),className:"w-full bg-black/60 border border-white/10 rounded-2xl px-5 py-3.5 text-white text-sm outline-none focus:border-white/30 transition-all shadow-inner",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Secure Phone"}),e.jsx("input",{value:r.phone,onChange:s=>n({...r,phone:s.target.value}),placeholder:"+91 XXXXXXXXXX",className:"w-full bg-black/60 border border-white/10 rounded-2xl px-5 py-3.5 text-white text-sm outline-none focus:border-white/30 transition-all shadow-inner"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Blood Type"}),e.jsxs("select",{value:r.bloodGroup,onChange:s=>n({...r,bloodGroup:s.target.value}),className:"w-full bg-black/60 border border-white/10 rounded-2xl px-5 py-3.5 text-white text-sm outline-none focus:border-white/30 appearance-none transition-all shadow-inner cursor-pointer",children:[e.jsx("option",{value:"",children:"Select Blood Group"}),["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Sector / Base"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:r.addressText,onChange:s=>n({...r,addressText:s.target.value}),placeholder:"e.g. Bhubaneswar",className:"flex-1 bg-black/60 border border-white/10 rounded-2xl px-5 py-3.5 text-white text-sm outline-none focus:border-white/30 transition-all shadow-inner"}),e.jsx("button",{type:"button",onClick:A,disabled:j,className:"px-4 bg-white/10 text-white border border-white/20 rounded-2xl hover:bg-white/20 transition-all disabled:opacity-50 flex items-center justify-center shadow-lg",title:"Lock GPS Coordinates",children:j?e.jsx($,{className:"animate-spin text-lg"}):e.jsx(z,{className:"text-lg"})})]})]}),e.jsxs("div",{className:"flex gap-3 mt-8 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"w-14 flex-shrink-0 py-4 rounded-2xl font-black text-xs uppercase bg-white/5 text-white/50 hover:bg-red-500/20 hover:text-red-400 transition-all flex items-center justify-center",children:e.jsx(_,{className:"text-lg"})}),e.jsxs("button",{type:"submit",className:`flex-1 py-4 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-3 transition-all ${C} text-white shadow-xl hover:scale-[1.02] active:scale-95`,children:[e.jsx(I,{className:"text-lg"})," Commit Record"]})]})]},"edit"):e.jsxs(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"mt-8 space-y-3 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4 text-white/80 bg-white/5 p-4 rounded-2xl hover:bg-white/10 transition-colors",children:[e.jsx(D,{className:i})," ",e.jsx("span",{className:"text-sm font-bold truncate",children:t.email})]}),e.jsxs("div",{className:"flex items-center gap-4 text-white/80 bg-white/5 p-4 rounded-2xl hover:bg-white/10 transition-colors",children:[e.jsx(X,{className:i})," ",e.jsx("span",{className:"text-sm font-bold truncate",children:t.phone||"Phone Classified"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-white/80 bg-white/5 p-4 rounded-2xl hover:bg-white/10 transition-colors",children:[e.jsx(B,{className:"text-red-400"})," ",e.jsxs("span",{className:"text-sm font-bold",children:["Type: ",t.bloodGroup||"Unknown"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-white/80 bg-white/5 p-4 rounded-2xl hover:bg-white/10 transition-colors",children:[e.jsx(E,{className:i})," ",e.jsx("span",{className:"text-sm font-bold truncate",children:t.addressText||"Sector Unknown"})]})]},"view")})]})}),e.jsxs("div",{className:"lg:col-span-8 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-yellow-500/10 to-[#111] border border-yellow-500/30 rounded-[2.5rem] p-8 md:p-10 relative overflow-hidden group hover:border-yellow-500/50 transition-all shadow-2xl",children:[e.jsx("div",{className:"absolute -right-10 -bottom-10 text-9xl text-yellow-500/5 group-hover:scale-110 transition-transform duration-700 pointer-events-none",children:e.jsx(R,{})}),e.jsxs("div",{className:"relative z-10 flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-yellow-500/70 text-xs font-black uppercase tracking-[0.3em] mb-2 flex items-center gap-2",children:[e.jsx(N,{className:"animate-pulse"})," Community Standing"]}),e.jsx("h3",{className:"text-6xl md:text-8xl font-black text-white tracking-tighter drop-shadow-xl",children:t.points||0}),e.jsx("p",{className:"text-white/60 font-bold uppercase tracking-widest text-[10px] mt-2",children:"Total Experience Points (XP)"})]}),e.jsxs("div",{className:"bg-black/40 backdrop-blur-md px-6 py-4 rounded-2xl border border-white/10 text-center min-w-[140px]",children:[e.jsx("p",{className:"text-white/40 text-[10px] font-black uppercase tracking-widest mb-1",children:"Current Rank"}),e.jsx("p",{className:"text-yellow-400 font-bold tracking-wider",children:t.rank||"Initiate"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-[#111] border border-white/10 rounded-[2.5rem] p-8 relative overflow-hidden group hover:bg-[#151515] transition-all",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-bl-[100px] transition-colors group-hover:bg-white/10"}),e.jsx("div",{className:`text-4xl mb-6 opacity-80 group-hover:scale-110 transition-transform ${i}`,children:e.jsx(U,{})}),w?e.jsx("div",{className:"h-14 w-24 bg-white/5 animate-pulse rounded-xl"}):e.jsx("h3",{className:"text-5xl font-black text-white",children:t.donationsCount||g.totalDonations}),e.jsx("p",{className:"text-white/40 text-[10px] uppercase font-black tracking-widest mt-3",children:"Missions Completed"})]}),e.jsxs("div",{className:"bg-[#111] border border-white/10 rounded-[2.5rem] p-8 relative overflow-hidden group hover:bg-[#151515] transition-all",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-bl-[100px] transition-colors group-hover:bg-white/10"}),e.jsx("div",{className:`text-4xl mb-6 opacity-80 group-hover:scale-110 transition-transform ${i}`,children:e.jsx(M,{})}),w?e.jsx("div",{className:"h-14 w-24 bg-white/5 animate-pulse rounded-xl"}):e.jsx("h3",{className:"text-5xl font-black text-white",children:g.activeListings}),e.jsx("p",{className:"text-white/40 text-[10px] uppercase font-black tracking-widest mt-3",children:"Active Field Operations"})]})]}),e.jsx("div",{className:"text-center pt-8 opacity-40 hover:opacity-100 transition-opacity",children:e.jsx("p",{className:"text-xs font-bold uppercase tracking-[0.2em] italic",children:'"A community is only as strong as its willingness to protect one another."'})})]})]})]})}):null};export{Z as default};
