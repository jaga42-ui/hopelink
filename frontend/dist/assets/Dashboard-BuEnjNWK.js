import{r as l,A as xe,u as pe,G as ue,z as r,j as e,H as he,I as G,J as be,s as F,f as C,K as M,i as me,b as ge,c as fe,d as we,a as ye,g as je,t as ve,M as Ne,N as R,O as z,P as ke,w as Ce,Q as q,e as Se,x as _e,R as Te,l as H}from"./index-BWa_XzmO.js";import{L as Ae}from"./Layout-DVG1ybMn.js";import{a as u}from"./api-Dehz_W2t.js";import{A as S}from"./index-BKbUjVKr.js";import{m as b}from"./proxy-Cu6WgvPD.js";import"./logo-DmaGRGNz.js";const W="https://hopelink-api.onrender.com",Oe=()=>{const{user:o,switchRole:Y}=l.useContext(xe),w=pe(),[m,g]=l.useState([]),[V,D]=l.useState(!0),[_,I]=l.useState(0),[J,K]=l.useState([]),[y,Q]=l.useState("All"),[O,X]=l.useState("urgent"),[Z,j]=l.useState(!1),[v,N]=l.useState(!1),[c,p]=l.useState({bloodGroup:"",quantity:"",hospital:"",addressText:"",description:""}),[x,f]=l.useState({isOpen:!1,donationId:null,pin:"",rating:5}),[h,k]=l.useState({isOpen:!1,donation:null}),[B,T]=l.useState([]),[P,A]=l.useState(!1),[$,ee]=l.useState(null);l.useEffect(()=>{if(!o?.token)return;(async()=>{try{const{data:s}=await u.get("/donations/feed");g(Array.isArray(s)?s:[]);const{data:a}=await u.get("/chat/inbox");if(Array.isArray(a)){const i=a.reduce((n,d)=>n+d.unreadCount,0);I(i)}D(!1)}catch{D(!1)}})()},[o]),l.useEffect(()=>{if(!o)return;const t=ue(W);return t.emit("setup",o._id),t.on("new_message_notification",()=>{I(s=>s+1),r("ðŸ’¬ New Message Received!",{position:"top-right",style:{borderRadius:"1rem",background:"#111",color:"#fff",border:"1px solid rgba(20, 184, 166, 0.5)",boxShadow:"0 0 20px rgba(20, 184, 166, 0.2)"}})}),t.on("donor_coming",s=>{K(a=>[...a,s]),r.success(`${s.donorName} is en route to help! ðŸ¦¸â€â™‚ï¸`,{duration:8e3,style:{background:"#dc2626",color:"#fff",fontWeight:"bold"}})}),()=>t.disconnect()},[o]);const te=t=>{const s="=".repeat((4-t.length%4)%4),a=(t+s).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(a),n=new Uint8Array(i.length);for(let d=0;d<i.length;++d)n[d]=i.charCodeAt(d);return n},U=async()=>{try{if(!("serviceWorker"in navigator)||!("PushManager"in window)){r.error("Push notifications are not supported by this browser.");return}if(await Notification.requestPermission()!=="granted"){r.error("Permission denied. We can't send you alerts.");return}const s=await navigator.serviceWorker.register("/sw.js");await navigator.serviceWorker.ready;const i=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:te("BBBTwXrxYTb2E8I0qTkG9JebgxELJP9tYXqoqmmuvt5QWZk6e4JJ0q-4vLn2WVuRjiu-ix0sp5P0kE-9sXhLnJs")});await u.post("/auth/subscribe",i),r.success("Notifications enabled! You will now receive background alerts.")}catch(t){console.error(t),r.error("Failed to enable notifications.")}};l.useEffect(()=>{if("Notification"in window&&Notification.permission==="default"){const t=setTimeout(()=>{r(s=>e.jsxs("div",{className:"flex flex-col items-center gap-3 p-2",children:[e.jsx("div",{className:"w-12 h-12 bg-teal-500/20 text-teal-400 rounded-full flex items-center justify-center text-xl mb-1",children:e.jsx(G,{className:"animate-pulse"})}),e.jsx("p",{className:"font-black text-sm text-center tracking-wide text-white",children:"STAY CONNECTED"}),e.jsx("p",{className:"text-xs text-center text-white/60 mb-2",children:"Enable background alerts so you never miss a critical message or community request."}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("button",{onClick:()=>{r.dismiss(s.id),U()},className:"flex-1 bg-teal-500 hover:bg-teal-400 text-white py-2.5 rounded-xl font-black text-[10px] uppercase tracking-widest transition-colors shadow-lg shadow-teal-500/20",children:"Enable Now"}),e.jsx("button",{onClick:()=>r.dismiss(s.id),className:"flex-1 bg-white/5 hover:bg-white/10 text-white py-2.5 rounded-xl font-black text-[10px] uppercase tracking-widest transition-colors border border-white/10",children:"Later"})]})]}),{duration:1/0,position:"top-center",style:{background:"#1a1a1a",border:"1px solid rgba(255,255,255,0.1)",minWidth:"320px",borderRadius:"1.5rem"}})},2500);return()=>clearTimeout(t)}},[]);const se=()=>{if(!navigator.geolocation){r.error("Geolocation is not supported by your browser");return}A(!0),navigator.geolocation.getCurrentPosition(async t=>{try{const{latitude:s,longitude:a}=t.coords,{data:i}=await H.get(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s}&lon=${a}&email=hopelink.dev@example.com`),n=i.address.city||i.address.town||i.address.village||i.address.state||"Unknown Location";p(d=>({...d,addressText:n})),r.success(`Location locked: ${n}`)}catch{r.error("Could not resolve location address")}finally{A(!1)}},()=>{A(!1),r.error("Please allow location permissions")})},ae=t=>{const s=t.target.value;if(p(a=>({...a,addressText:s})),$&&clearTimeout($),s.length>2){const a=setTimeout(async()=>{try{const{data:i}=await H.get(`https://nominatim.openstreetmap.org/search?format=json&q=${s}&limit=4&email=hopelink.dev@example.com`);T(i)}catch{console.error("Autocomplete failed")}},600);ee(a)}else T([])},re=t=>{const s=t.split(",")[0];p(a=>({...a,addressText:s})),T([])},ie=async t=>{t.preventDefault(),N(!0);try{const s=new FormData;s.append("listingType","request"),s.append("category","blood"),s.append("isEmergency","true"),s.append("bloodGroup",c.bloodGroup),s.append("quantity",`${c.quantity} Units`),s.append("title",`URGENT: ${c.bloodGroup} Blood Needed!`),s.append("description",c.description),s.append("addressText",`${c.hospital}, ${c.addressText}`);const{data:a}=await u.post("/donations",s);g([a,...m]),j(!1),p({bloodGroup:"",quantity:"",hospital:"",addressText:"",description:""}),r.success("EMERGENCY BROADCAST SENT!")}catch(s){r.error(s.response?.data?.message||"Failed to broadcast SOS")}finally{N(!1)}},oe=async t=>{if(window.confirm("Are you sure you want to delete this listing?"))try{await u.delete(`/donations/${t}`),g(m.filter(s=>s._id!==t)),r.success("Listing successfully removed.")}catch{r.error("Failed to delete the listing.")}},le=async t=>{t.preventDefault(),N(!0);try{await u.patch(`/donations/${x.donationId}/fulfill`,{pin:x.pin,rating:x.rating}),g(m.filter(s=>s._id!==x.donationId)),r.success("Handshake Verified! Points & Rating applied ðŸŒŸ"),f({isOpen:!1,donationId:null,pin:"",rating:5})}catch(s){r.error(s.response?.data?.message||"Incorrect PIN")}finally{N(!1)}},ne=async t=>{try{await u.post(`/donations/${t}/request`,{}),g(m.map(s=>s._id===t?{...s,requestedBy:[...s.requestedBy||[],{_id:o._id,name:o.name}]}:s)),r.success("Request sent! The donor will be notified.")}catch(s){r.error(s.response?.data?.message||"Failed to send request")}},ce=async(t,s)=>{try{const{data:a}=await u.patch(`/donations/${t}/approve`,{receiverId:s}),i=h.donation.requestedBy.find(n=>n._id===s)?.name||"Receiver";g(m.map(n=>n._id===t?{...n,status:"pending",receiverId:s}:n)),k({isOpen:!1,donation:null}),r.success("Approved! You can now chat with them."),w(`/chat/${a.chatRoomId}`,{state:{otherUserId:s,otherUserName:i,itemTitle:h.donation.title}})}catch(a){r.error(a.response?.data?.message||"Approval failed")}},L=m.filter(t=>y==="All"?!0:t.category?.toLowerCase()===y.toLowerCase()).sort((t,s)=>{if(O==="urgent"){if(t.isEmergency&&!s.isEmergency)return-1;if(!t.isEmergency&&s.isEmergency)return 1}return new Date(s.createdAt)-new Date(t.createdAt)});return o?e.jsx(Ae,{children:e.jsxs("div",{className:"max-w-6xl mx-auto pb-24 relative",children:[e.jsx("div",{className:"fixed top-24 right-8 z-[100] w-72 space-y-3 pointer-events-none",children:e.jsx(S,{children:J.map((t,s)=>e.jsxs(b.div,{initial:{x:100,opacity:0},animate:{x:0,opacity:1},exit:{opacity:0,scale:.9},className:"bg-red-600 border border-red-400 p-4 rounded-2xl shadow-2xl flex items-center gap-4 pointer-events-auto",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white",children:e.jsx(he,{className:"text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-[10px] text-white/70 font-black uppercase tracking-widest",children:"En Route to Help"}),e.jsx("p",{className:"text-sm font-bold text-white truncate",children:t.donorName})]})]},s))})}),e.jsxs("header",{className:"mb-8 flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-4xl md:text-5xl font-black text-white italic tracking-tighter",children:["COMMUNITY ",e.jsx("span",{className:o.activeRole==="donor"?"text-teal-400":"text-blue-400",children:"FEED."})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full md:w-auto items-center",children:[o&&!o.isAdmin&&e.jsxs("button",{onClick:()=>{Y(),setTimeout(()=>window.location.reload(),300)},className:"px-6 py-4 bg-[#111] border border-white/10 rounded-full flex items-center gap-3 hover:bg-white/5 transition-all shadow-lg",title:"Switch Role",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${o.activeRole==="donor"?"text-teal-400":"text-white/30"}`,children:"Donor"}),e.jsx("div",{className:"w-10 h-5 bg-black rounded-full relative border border-white/20",children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full transition-all duration-300 ${o.activeRole==="donor"?"bg-teal-400 left-0.5":"bg-blue-400 left-[22px]"}`})}),e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${o.activeRole==="receiver"?"text-blue-400":"text-white/30"}`,children:"Receiver"})]}),e.jsx("button",{onClick:U,className:"p-4 bg-white/5 border border-white/10 rounded-full hover:bg-white/10 text-white transition-all shadow-lg flex items-center justify-center group",title:"Enable Background Notifications",children:e.jsx(G,{className:"text-xl text-yellow-400 group-hover:scale-110 transition-transform"})}),o.activeRole==="donor"&&e.jsxs("button",{onClick:()=>w("/donations"),className:"px-8 py-4 bg-teal-500/10 text-teal-400 border border-teal-500/30 rounded-full font-black uppercase tracking-widest text-sm hover:bg-teal-500 hover:text-white transition-all flex items-center justify-center gap-3 shadow-lg",children:[e.jsx(be,{className:"text-xl"})," Post an Item"]}),e.jsxs("button",{onClick:()=>j(!0),className:"group relative px-8 py-4 bg-red-600 rounded-full font-black text-white uppercase tracking-widest text-sm shadow-[0_0_40px_rgba(220,38,38,0.4)] hover:shadow-[0_0_60px_rgba(220,38,38,0.6)] hover:scale-105 transition-all flex items-center justify-center gap-3 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform"}),e.jsx(F,{className:"text-xl animate-pulse"})," Emergency SOS"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-8 bg-[#111] p-4 rounded-3xl border border-white/10",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto w-full md:w-auto no-scrollbar pb-2 md:pb-0",children:["All","Blood","Food","Clothes","Book"].map(t=>e.jsx("button",{onClick:()=>Q(t),className:`px-6 py-2.5 rounded-full font-black text-xs uppercase tracking-widest whitespace-nowrap transition-all flex-shrink-0 ${y===t?"bg-white text-black shadow-lg shadow-white/20":"bg-white/5 text-white/50 hover:bg-white/10 hover:text-white"}`,children:t},t))}),e.jsxs("div",{className:"w-full md:w-auto flex items-center justify-between md:justify-end gap-3 border-t border-white/10 md:border-0 pt-4 md:pt-0",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-white/40",children:"Sort By:"}),e.jsxs("select",{value:O,onChange:t=>X(t.target.value),className:"bg-black/50 border border-white/10 rounded-xl px-4 py-2.5 text-white text-xs font-bold outline-none focus:border-white/30 appearance-none cursor-pointer",children:[e.jsx("option",{value:"urgent",children:"Urgent First"}),e.jsx("option",{value:"newest",children:"Newest First"})]})]})]}),V?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(C,{className:"animate-spin text-4xl text-teal-500"})}):L.length===0?e.jsxs("div",{className:"text-center py-20 text-white/40 font-bold uppercase tracking-widest",children:["No ",y!=="All"?y:""," listings found."]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:L.map(t=>{const s=t.isEmergency,a=t.listingType==="request"&&!s;let i="bg-[#111] border-white/10 hover:border-white/20 shadow-xl",n="bg-teal-500/20 text-teal-400",d="bg-white/5 hover:bg-white/10 text-white";return s?(i="bg-red-500/5 border-red-500/30 border shadow-lg",n="bg-red-500 text-white",d="bg-red-600 hover:bg-red-500 text-white"):a&&(i="bg-[#0f172a] border-blue-500/30 border shadow-lg",n="bg-blue-500/20 text-blue-400",d="bg-blue-600 hover:bg-blue-500 text-white"),e.jsxs("div",{className:`rounded-[2rem] p-6 flex flex-col relative overflow-hidden transition-all hover:-translate-y-1 border ${i}`,children:[s&&e.jsxs("div",{className:"absolute top-0 left-0 w-full bg-red-600 text-white text-[10px] font-black uppercase tracking-widest text-center py-1.5 flex items-center justify-center gap-2 z-10",children:[e.jsx(M,{})," Critical Emergency"]}),a&&e.jsxs("div",{className:"absolute top-0 left-0 w-full bg-blue-600 text-white text-[9px] font-black uppercase tracking-[0.2em] text-center py-1 flex items-center justify-center gap-2 z-10",children:[e.jsx(me,{})," Community Request"]}),e.jsxs("div",{className:`${s||a?"mt-6":"mt-0"} flex justify-between items-start mb-4`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.donorId?.profilePic?e.jsx("img",{src:t.donorId.profilePic,alt:"User",className:"w-10 h-10 rounded-xl object-cover border border-white/10",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center font-black text-white/50 uppercase",children:t.donorId?.name?.charAt(0)||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-bold text-sm",children:t.donorId?.name||"Unknown User"}),e.jsx("p",{className:"text-white/40 text-[10px] font-black uppercase tracking-widest",children:t.category})]})]}),t.bloodGroup&&e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-black z-10 ${n}`,children:t.bloodGroup})]}),t.image?e.jsxs("div",{className:"w-full h-48 mb-4 rounded-xl overflow-hidden border border-white/5 relative group flex-shrink-0",children:[e.jsx("img",{src:t.image.startsWith("http")?t.image:`${W}${t.image}`,alt:t.title,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"})]}):t.category==="blood"?e.jsxs("div",{className:"w-full h-48 mb-4 rounded-xl overflow-hidden border border-red-500/20 bg-gradient-to-br from-red-900/40 to-[#111] flex flex-col items-center justify-center relative group flex-shrink-0",children:[e.jsx(F,{className:"text-6xl text-red-500 animate-pulse drop-shadow-[0_0_15px_rgba(239,68,68,0.6)] mb-3"}),e.jsx("span",{className:"text-4xl font-black text-white drop-shadow-md tracking-tighter",children:t.bloodGroup||"BLOOD"}),e.jsx("span",{className:"text-red-400 text-[10px] uppercase font-black tracking-[0.4em] mt-2",children:"Required Immediately"})]}):null,e.jsx("h3",{className:"text-xl font-black text-white mb-2 leading-tight",children:t.title}),t.quantity&&e.jsxs("p",{className:"text-white/80 font-bold text-xs mb-3",children:["Qty: ",e.jsx("span",{className:"text-white",children:t.quantity})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[t.foodType&&e.jsxs("span",{className:"flex items-center gap-1 bg-white/5 border border-white/10 px-2.5 py-1 rounded-md text-[10px] font-bold text-white/70 uppercase tracking-wider",children:[e.jsx(ge,{className:t.foodType==="Veg"?"text-green-400":"text-orange-400"})," ",t.foodType]}),t.expiryDate&&e.jsxs("span",{className:"flex items-center gap-1 bg-white/5 border border-white/10 px-2.5 py-1 rounded-md text-[10px] font-bold text-white/70 uppercase tracking-wider",children:[e.jsx(fe,{className:"text-red-400"})," Exp: ",new Date(t.expiryDate).toLocaleDateString()]}),t.bookAuthor&&e.jsxs("span",{className:"flex items-center gap-1 bg-white/5 border border-white/10 px-2.5 py-1 rounded-md text-[10px] font-bold text-white/70 uppercase tracking-wider",children:[e.jsx(we,{className:"text-blue-400"})," ",t.bookAuthor]}),t.condition&&e.jsxs("span",{className:"flex items-center gap-1 bg-white/5 border border-white/10 px-2.5 py-1 rounded-md text-[10px] font-bold text-white/70 uppercase tracking-wider",children:[e.jsx(ye,{className:"text-purple-400"})," ",t.condition]}),t.pickupTime&&e.jsxs("span",{className:"flex items-center gap-1 bg-white/5 border border-white/10 px-2.5 py-1 rounded-md text-[10px] font-bold text-white/70 uppercase tracking-wider",children:[e.jsx(je,{className:"text-yellow-400"})," ",t.pickupTime]})]}),e.jsx("p",{className:"text-white/60 text-sm mb-6 flex-1 line-clamp-3",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-white/10 mt-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 text-white/40 text-xs font-bold max-w-[45%]",children:[e.jsx(ve,{className:"flex-shrink-0"}),e.jsx("span",{className:"truncate",children:t.location?.addressText||t.donorId?.addressText||"Location Unknown"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.donorId?._id===o._id?e.jsxs(e.Fragment,{children:[t.status==="active"&&t.requestedBy?.length>0&&e.jsxs("button",{onClick:()=>k({isOpen:!0,donation:t}),className:"px-3 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all bg-blue-500/20 text-blue-400 hover:bg-blue-500 hover:text-white flex items-center gap-2 border border-blue-500/30",children:[e.jsx(Ne,{})," Requests ",e.jsx("span",{className:"bg-blue-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-[9px]",children:t.requestedBy.length})]}),t.status==="pending"&&e.jsxs("button",{onClick:()=>{const E=t.requestedBy?.find(de=>de._id===t.receiverId)||{};w(`/chat/${t._id}_${t.receiverId}`,{state:{otherUserId:t.receiverId,otherUserName:E.name||"Receiver",itemTitle:t.title}})},className:"px-3 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all bg-teal-500/20 text-teal-400 hover:bg-teal-500 hover:text-white flex items-center gap-2 border border-teal-500/30",children:[e.jsx(R,{})," Chat"]}),e.jsx("button",{onClick:()=>f({isOpen:!0,donationId:t._id,pin:"",rating:5}),className:"px-3 py-2 rounded-xl text-xs font-black uppercase transition-all bg-teal-500/10 text-teal-400 hover:bg-teal-500 hover:text-white",title:"Mark as Fulfilled",children:e.jsx(z,{className:"text-lg"})}),e.jsx("button",{onClick:()=>oe(t._id),className:"px-3 py-2 rounded-xl text-xs font-black uppercase transition-all bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white",title:"Delete Post",children:e.jsx(ke,{className:"text-lg"})})]}):e.jsx(e.Fragment,{children:t.status==="active"?t.requestedBy?.some(E=>E._id===o._id)?e.jsx("button",{disabled:!0,className:"px-4 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all bg-white/5 text-white/30 cursor-not-allowed border border-white/5",children:"Pending..."}):e.jsxs("button",{onClick:()=>ne(t._id),className:`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all flex items-center gap-2 ${d}`,children:[e.jsx(R,{})," ",a?"Offer Help":"Request Item"]}):t.receiverId===o._id?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-end mr-2",children:[e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest text-white/40",children:"Handshake PIN"}),e.jsx("span",{className:"text-xs font-black text-white bg-teal-500/20 px-2 py-0.5 rounded border border-teal-500/30",children:t.pickupPIN})]}),e.jsxs("button",{onClick:()=>w(`/chat/${t._id}_${o._id}`),className:"px-4 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all flex items-center gap-2 bg-teal-500/20 text-teal-400 hover:bg-teal-500 hover:text-white",children:[e.jsx(R,{})," Open Chat"]})]}):e.jsx("button",{disabled:!0,className:"px-4 py-2 rounded-xl text-xs font-black uppercase tracking-widest transition-all bg-yellow-500/10 text-yellow-500/50 cursor-not-allowed border border-yellow-500/10",children:"Reserved"})})})]})]},t._id)})}),e.jsx("button",{onClick:()=>w("/chat/inbox"),className:"fixed bottom-8 right-8 z-40 bg-teal-500 hover:bg-teal-400 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-[0_0_30px_rgba(20,184,166,0.4)] hover:scale-110 transition-transform",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"text-2xl"}),_>0&&e.jsx("span",{className:"absolute -top-2 -right-3 bg-red-500 text-white text-[10px] font-black min-w-[20px] h-5 px-1 rounded-full flex items-center justify-center border-2 border-[#111]",children:_>9?"9+":_})]})}),e.jsx(S,{children:Z&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/80 backdrop-blur-md",onClick:()=>j(!1)}),e.jsxs(b.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-md bg-[#111] border-2 border-red-500/30 rounded-[2rem] p-8 shadow-[0_0_50px_rgba(220,38,38,0.2)] overflow-visible",children:[e.jsx("button",{onClick:()=>j(!1),className:"absolute top-6 right-6 text-white/40 hover:text-white transition-colors",children:e.jsx(q,{className:"text-xl"})}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 text-red-500",children:[e.jsx(F,{className:"text-4xl animate-pulse"}),e.jsxs("h2",{className:"text-2xl font-black italic tracking-tighter text-white",children:["EMERGENCY ",e.jsx("br",{}),"BROADCAST"]})]}),e.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Blood Group"}),e.jsxs("select",{required:!0,value:c.bloodGroup,onChange:t=>p({...c,bloodGroup:t.target.value}),className:"w-full bg-red-500/5 border border-red-500/20 rounded-2xl px-5 py-4 text-white font-bold outline-none focus:border-red-500 transition-colors appearance-none cursor-pointer",children:[e.jsx("option",{value:"",disabled:!0,className:"bg-[#111] text-white",children:"Select"}),["A+","A-","B+","B-","AB+","AB-","O+","O-"].map(t=>e.jsx("option",{value:t,className:"bg-[#111] text-white",children:t},t))]})]}),e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Units"}),e.jsx("input",{required:!0,type:"number",min:"1",placeholder:"e.g. 2",value:c.quantity,onChange:t=>p({...c,quantity:t.target.value}),className:"w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none focus:border-white/30 transition-colors"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Hospital Name"}),e.jsx("input",{required:!0,value:c.hospital,onChange:t=>p({...c,hospital:t.target.value}),placeholder:"e.g. Apollo Hospital",className:"w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none focus:border-white/30 transition-colors"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"City / Area"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{required:!0,value:c.addressText,onChange:ae,placeholder:"Type city or use GPS...",className:"flex-1 bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white font-bold outline-none focus:border-white/30 transition-colors"}),e.jsx("button",{type:"button",onClick:se,disabled:P,className:"px-5 bg-red-500/10 text-red-400 border border-red-500/30 rounded-2xl hover:bg-red-500 hover:text-white transition-all disabled:opacity-50 flex items-center justify-center",title:"Use GPS",children:P?e.jsx(C,{className:"animate-spin text-lg"}):e.jsx(Se,{className:"text-lg"})})]}),B.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-2 bg-[#1a1a1a] border border-white/10 rounded-xl overflow-hidden shadow-2xl",children:B.map((t,s)=>e.jsx("div",{onClick:()=>re(t.display_name),className:"px-5 py-3 text-sm text-white/70 hover:text-white hover:bg-white/5 cursor-pointer border-b border-white/5 last:border-0 truncate",children:t.display_name},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest text-white/40 ml-4 mb-1 block",children:"Patient Details"}),e.jsx("textarea",{required:!0,value:c.description,onChange:t=>p({...c,description:t.target.value}),placeholder:"Require urgent blood for surgery...",rows:"3",className:"w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-4 text-white text-sm outline-none focus:border-white/30 transition-colors resize-none"})]}),e.jsx("button",{type:"submit",disabled:v,className:"w-full mt-4 py-4 bg-red-600 hover:bg-red-500 rounded-2xl font-black text-white uppercase tracking-widest text-sm transition-all shadow-lg shadow-red-600/20 disabled:opacity-50 flex items-center justify-center gap-3",children:v?e.jsx(C,{className:"animate-spin text-xl"}):e.jsxs(e.Fragment,{children:[e.jsx(M,{})," Send Alert to Network"]})})]})]})]})}),e.jsx(S,{children:x.isOpen&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/80 backdrop-blur-md",onClick:()=>f({isOpen:!1,donationId:null,pin:"",rating:5})}),e.jsxs(b.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-sm bg-[#111] border border-white/10 rounded-[2rem] p-8 shadow-[0_0_50px_rgba(20,184,166,0.1)] text-center",children:[e.jsx("button",{onClick:()=>f({isOpen:!1,donationId:null,pin:"",rating:5}),className:"absolute top-5 right-5 text-white/40 hover:text-white transition-colors",children:e.jsx(q,{className:"text-xl"})}),e.jsx("div",{className:"w-16 h-16 bg-teal-500/10 text-teal-400 rounded-full flex items-center justify-center text-3xl mx-auto mb-4 border border-teal-500/20",children:e.jsx(_e,{})}),e.jsx("h2",{className:"text-2xl font-black text-white mb-2 tracking-tighter",children:"SECURE HANDSHAKE"}),e.jsx("p",{className:"text-white/50 text-xs font-bold leading-relaxed mb-6",children:"To claim your impact points, enter the 4-digit PIN provided by the person who received your item."}),e.jsxs("form",{onSubmit:le,children:[e.jsx("input",{type:"text",required:!0,maxLength:"4",placeholder:"ENTER 4-DIGIT PIN",value:x.pin,onChange:t=>f({...x,pin:t.target.value.replace(/\D/g,"")}),className:"w-full bg-black/40 border-2 border-dashed border-white/20 rounded-2xl px-5 py-4 text-center text-white text-2xl tracking-[0.5em] font-black outline-none focus:border-teal-500 transition-colors mb-4"}),e.jsxs("div",{className:"mb-6 bg-black/20 p-4 rounded-2xl border border-white/5",children:[e.jsx("p",{className:"text-white/50 text-[10px] uppercase font-black tracking-widest mb-3",children:"Rate the Receiver"}),e.jsx("div",{className:"flex justify-center gap-3",children:[1,2,3,4,5].map(t=>e.jsx(Te,{onClick:()=>f({...x,rating:t}),className:`text-3xl cursor-pointer transition-transform hover:scale-110 ${x.rating>=t?"text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.5)]":"text-white/10"}`},t))})]}),e.jsx("button",{type:"submit",disabled:v||x.pin.length!==4,className:"w-full py-4 bg-teal-500 hover:bg-teal-400 rounded-2xl font-black text-white uppercase tracking-widest text-sm transition-all shadow-lg shadow-teal-500/20 disabled:opacity-50 disabled:shadow-none flex items-center justify-center gap-2",children:v?e.jsx(C,{className:"animate-spin text-xl"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{})," Verify & Complete"]})})]})]})]})}),e.jsx(S,{children:h.isOpen&&h.donation&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/80 backdrop-blur-md",onClick:()=>k({isOpen:!1,donation:null})}),e.jsxs(b.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-md bg-[#111] border border-white/10 rounded-[2rem] p-8 shadow-[0_0_50px_rgba(59,130,246,0.1)]",children:[e.jsx("button",{onClick:()=>k({isOpen:!1,donation:null}),className:"absolute top-6 right-6 text-white/40 hover:text-white transition-colors",children:e.jsx(q,{className:"text-xl"})}),e.jsx("h2",{className:"text-2xl font-black text-white mb-2 tracking-tighter",children:"COMMUNITY REQUESTS"}),e.jsxs("p",{className:"text-white/50 text-xs font-bold leading-relaxed mb-6",children:["Choose one person to connect with for ",e.jsxs("span",{className:"text-white",children:['"',h.donation.title,'"']}),". Approving a request opens a private chat and reserves the item."]}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto no-scrollbar pr-2",children:h.donation.requestedBy.map(t=>e.jsxs("div",{className:"flex items-center justify-between bg-black/40 border border-white/5 p-4 rounded-2xl hover:border-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.profilePic?e.jsx("img",{src:t.profilePic,alt:"User",className:"w-10 h-10 rounded-xl object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center font-black text-white/50 uppercase",children:t.name?.charAt(0)||"?"}),e.jsx("span",{className:"text-white font-bold text-sm",children:t.name})]}),e.jsx("button",{onClick:()=>ce(h.donation._id,t._id),className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-xl text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-blue-500/20",children:"Approve"})]},t._id))})]})]})})]})}):null};export{Oe as default};
